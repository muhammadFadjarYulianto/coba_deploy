import{c as ue,aA as K,Q as O,r,a2 as je,j as e,$ as fe,a0 as ke,T as C,M as ve,a7 as T,a8 as D,a9 as P,aa as A,ad as E,B as m,a3 as Ne,a4 as M,a5 as B,a6 as _,aB as ye}from"./index-CS89oW_i.js";import{C as Ce,b as be}from"./card-BhL9r1mA.js";import{T as we,a as Se,b,c as k,d as Te,e as u}from"./table-DDg6W2BM.js";import{B as De,a as Pe,b as R,c as Y,d as z,e as q}from"./breadcrumb-C9uIPhjY.js";import{L as w}from"./label-Dc6lHONL.js";import{P as Ae,c as Ee,d as H,a as Me,b as Be,e as _e}from"./pagination-CKnmYpEc.js";import{B as W}from"./badge-476qyi6F.js";import{S as Re}from"./search-Dnv9-eiG.js";import{E as Ke}from"./eye-DjVyHYfL.js";import{T as Oe}from"./trash-2-Cy-5REkh.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ue("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Fe=async n=>{try{const t=new URL(K);if(n.keyword&&t.searchParams.append("keyword",n.keyword),n.page){const g=(n.page-1)*(n.limit||10);t.searchParams.append("start",String(g+1))}n.limit&&t.searchParams.append("limit",String(n.limit));const d=await O.get(t.toString(),{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});return console.log("API Response:",d.data),{comments:d.data.data.results.map(g=>({...g,status:g.status.toUpperCase()})),pagination:{total_data:d.data.data.total_data,per_page:d.data.data.per_page}}}catch(t){throw console.error("Failed to fetch comments:",t),new Error("Failed to fetch comments. Please try again.")}};async function Ge(n){try{const t=localStorage.getItem("access_token");if(!t)throw new Error("Token not found");return(await O.get(`${K}/${n}`,{headers:{Authorization:`Bearer ${t}`}})).data.data}catch(t){throw console.error("Gagal mendapatkan data komentar:",t.response||t.message),new Error("Gagal mengambil data komentar. Silakan coba lagi.")}}async function Z(n,t){try{const d=t==="approve",g=await O.put(`${K}/${n}`,{is_approved:d},{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}});return console.log("Update response:",g.data),g.data}catch(d){throw console.error("Update failed:",d),d}}async function Ie(n){try{const t=localStorage.getItem("access_token");return(await O.delete(`${K}/${n}`,{headers:{Authorization:`Bearer ${t}`}})).data}catch(t){throw console.error("Gagal menghapus komentar:",t.response||t.message),new Error("Gagal menghapus komentar. Silakan coba lagi.")}}function We(){const[n,t]=r.useState([]),[d,g]=r.useState(1),[$,ee]=r.useState(1),[ae,h]=r.useState(!0),[se,J]=r.useState(null),[U,te]=r.useState(0);r.useState([]),r.useState(!1);const[i,V]=r.useState({keyword:"",page:1,limit:10}),[ne,F]=r.useState(!1),[re,G]=r.useState(!1),[o,j]=r.useState(null),[le,v]=r.useState(!1),[ie,N]=r.useState(!1);r.useState({currentPage:1,totalPages:1,limit:10});const{toast:f}=je(),y=async()=>{try{h(!0);const a=Object.fromEntries(Object.entries(i).filter(([x,p])=>p!==""&&p!==null)),{comments:s,pagination:c}=await Fe(a);console.log("Fetched data:",{comments:s,pagination:c}),t(s),te(c.total_data),ee(Math.ceil(c.total_data/i.limit)),g(i.page),J(null)}catch(a){console.error("Fetch error:",a),J(a instanceof Error?a.message:"Gagal mengambil komentar")}finally{h(!1)}},I=async a=>{try{h(!0),V(s=>({...s,page:a})),console.log("Changing to page:",a),await y()}catch(s){console.error("Page change error:",s)}finally{h(!1)}},oe=(a,s)=>{V(c=>{const x={...c,[a]:s||"",page:1};return Object.keys(x).forEach(p=>{(x[p]===""||x[p]===null)&&delete x[p]}),x})};r.useEffect(()=>{y()},[i]);const ce=a=>{console.log("Approve clicked for:",a);const s=n.find(c=>c.id===a);s&&(j(s),v(!0))},de=a=>{console.log("Reject clicked for:",a);const s=n.find(c=>c.id===a);s&&(j(s),N(!0))},Q=()=>{v(!1),N(!1),F(!1),j(null)},me=async a=>{try{h(!0),console.log("Approving comment:",a),await Z(a,"approve"),f({title:"Berhasil",description:"Komentar berhasil disetujui"}),await y(),v(!1),j(null)}catch(s){console.error("Approve error:",s),f({title:"Gagal",description:"Gagal menyetujui komentar",variant:"destructive"})}finally{h(!1)}},he=async a=>{try{h(!0),console.log("Rejecting comment:",a),await Z(a,"reject"),f({title:"Berhasil",description:"Komentar berhasil ditolak",variant:"destructive"}),await y(),N(!1),j(null)}catch(s){console.error("Reject error:",s),f({title:"Gagal",description:"Gagal menolak komentar",variant:"destructive"})}finally{h(!1)}},xe=async a=>{try{h(!0);const s=await Ge(a.id);j({...s,status:s.status,created_at:s.created_at,updated_at:s.updated_at}),G(!0)}catch{f({title:"Gagal",description:"Gagal memuat detail komentar",variant:"destructive"})}finally{h(!1)}},pe=async a=>{try{await Ie(a),y(),f({title:"Komentar Dihapus",description:"Komentar telah berhasil dihapus."})}catch{f({title:"Gagal Menghapus Komentar",description:"Terjadi kesalahan saat menghapus komentar.",variant:"destructive"})}},X=a=>{const s=new Date(a),c=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],x=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],p=c[s.getDay()],L=s.getDate(),S=x[s.getMonth()],l=s.getFullYear();return`${p}, ${L} ${S} ${l}`},ge=({comments:a,loading:s,error:c,formatDate:x,onApprove:p,onReject:L,onViewDetail:S})=>s?e.jsx(b,{children:e.jsx(u,{colSpan:6,className:"text-center py-4",children:e.jsx(C,{variant:"p-regular",children:"Loading..."})})}):c?e.jsx(b,{children:e.jsx(u,{colSpan:6,className:"text-center py-4 text-red-500",children:e.jsx(C,{variant:"p-regular",children:c})})}):a.length===0?e.jsx(b,{children:e.jsx(u,{colSpan:6,className:"text-center py-4 text-gray-500",children:e.jsx(C,{variant:"p-regular",children:"Tidak ada komentar"})})}):e.jsx(e.Fragment,{children:a.map(l=>e.jsxs(b,{children:[e.jsx(u,{onClick:()=>S(l),children:e.jsx(W,{variant:l.status==="APPROVED"?"success":l.status==="REJECTED"?"destructive":"secondary",children:l.status})}),e.jsx(u,{children:l.username}),e.jsx(u,{children:l.email}),e.jsx(u,{children:x(l.created_at)}),e.jsx(u,{children:e.jsx(Ne,{children:e.jsx("div",{className:"flex gap-2",children:l.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsx(B,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"icon",onClick:()=>p(l.id),children:e.jsx($e,{className:"w-4 h-4"})})}),e.jsx(_,{children:e.jsx("p",{children:"Setujui"})})]}),e.jsxs(M,{children:[e.jsx(B,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"icon",onClick:()=>L(l.id),children:e.jsx(ye,{className:"w-4 h-4"})})}),e.jsx(_,{children:e.jsx("p",{children:"Tolak"})})]})]})})})}),e.jsx(u,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(M,{children:[e.jsx(B,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"icon",onClick:()=>S(l),children:e.jsx(Ke,{className:"w-4 h-4"})})}),e.jsx(_,{className:"bg-emerald-600",children:e.jsx("p",{className:"text-background",children:"Lihat Detail"})})]}),e.jsxs(M,{children:[e.jsx(B,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>{j(l),F(!0)},children:e.jsx(Oe,{className:"w-4 h-4"})})}),e.jsx(_,{className:"bg-emerald-600",children:e.jsx("p",{className:"text-background",children:"Hapus Komentar"})})]})]})})]},l.id))});return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"flex h-16 shrink-0 items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-4",children:[e.jsx(fe,{className:"-ml-1"}),e.jsx(ke,{orientation:"vertical",className:"mr-2 h-4"}),e.jsx(De,{children:e.jsxs(Pe,{children:[e.jsx(R,{className:"hidden md:block",children:e.jsx(Y,{href:"/",className:"text-[16px] font-normal leading-[28px]",children:"Beranda"})}),e.jsx(z,{className:"hidden md:block"}),e.jsx(R,{children:e.jsx(Y,{href:"/Dashboard",className:"text-[16px] font-normal leading-[28px]",children:"Dashboard"})}),e.jsx(z,{className:"hidden md:block"}),e.jsx(R,{children:e.jsx(q,{className:"text-[16px] font-normal leading-[28px]",children:"Konten"})}),e.jsx(z,{className:"hidden md:block"}),e.jsx(R,{children:e.jsx(q,{className:"text-[16px] font-normal leading-[28px]",children:"Komentar"})})]})})]})}),e.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4 pt-0 pb-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mr-0 md:mr-6",children:[e.jsxs("div",{children:[e.jsx(C,{variant:"h1",className:"text-4xl lg:text-5xl",children:"Manajemen Komentar"}),e.jsx(C,{variant:"p-regular",className:"text-slate-700 mt-4",children:"Manajemen Komentar memungkinkan Anda untuk mengelola komentar yang akan ditampilkan di halaman blog."})]}),e.jsxs("div",{className:"relative w-full sm:w-[300px]",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(ve,{placeholder:"Cari produk berdasarkan nama",value:i.keyword,onChange:a=>oe("keyword",a.target.value),className:"h-11 pl-10 text-emerald-600 border-2 border-emerald-500 w-full focus:ring-emerald-500 focus:border-emerald-500"})]})]}),e.jsx("div",{className:"grid gap-4 grid-cols-1",children:e.jsx(Ce,{children:e.jsx(be,{className:"p-0 md:p-6",children:e.jsxs(we,{children:[e.jsx(Se,{children:e.jsxs(b,{children:[e.jsx(k,{className:"text-xl",children:"status"}),e.jsx(k,{className:"text-xl",children:"username"}),e.jsx(k,{className:"text-xl",children:"email"}),e.jsx(k,{className:"text-xl ",children:"Tanggal Dibuat"}),e.jsx(k,{className:"text-xl ",children:"Setujui"}),e.jsx(k,{className:"text-xl text-right",children:"Aksi"})]})}),e.jsx(Te,{children:e.jsx(ge,{comments:n,loading:ae,error:se,formatDate:X,onApprove:ce,onReject:de,onViewDetail:xe})})]})})})}),$>1&&e.jsxs("div",{className:"mt-4",children:[e.jsx(Ae,{children:e.jsxs(Ee,{children:[e.jsx(H,{children:e.jsx(Me,{onClick:()=>I(i.page-1),className:i.page<=1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:$},(a,s)=>s+1).map(a=>e.jsx(H,{children:e.jsx(Be,{className:"cursor-pointer",onClick:()=>I(a),isActive:i.page===a,children:a})},a)),e.jsx(H,{children:e.jsx(_e,{onClick:()=>I(i.page+1),className:i.page>=$?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsxs("div",{className:"text-center mt-2 text-sm text-gray-600",children:["Showing ",(i.page-1)*i.limit+1," to"," ",Math.min(i.page*i.limit,U)," of ",U," ","entries"]})]})]}),e.jsx(T,{open:re,onOpenChange:G,children:e.jsxs(D,{className:"max-w-2xl",children:[e.jsx(P,{children:e.jsx(A,{children:"Detail Komentar"})}),o&&e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(w,{className:"font-bold",children:"Status"}),e.jsx("div",{className:"col-span-3",children:e.jsx(W,{variant:o.status==="APPROVED"?"success":o.status==="REJECTED"?"destructive":"secondary",children:o.status})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(w,{className:"font-bold",children:"Username"}),e.jsx("div",{className:"col-span-3",children:o.username})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(w,{className:"font-bold",children:"Email"}),e.jsx("div",{className:"col-span-3",children:o.email})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(w,{className:"font-bold",children:"Tanggal Dibuat"}),e.jsx("div",{className:"col-span-3",children:X(o.created_at)})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(w,{className:"font-bold",children:"Komentar"}),e.jsx("div",{className:"col-span-3 whitespace-pre-wrap",children:o.comment})]})]}),e.jsx(E,{children:e.jsx(m,{variant:"secondary",onClick:()=>G(!1),children:"Tutup"})})]})}),e.jsx(T,{open:le,onOpenChange:v,children:e.jsxs(D,{children:[e.jsx(P,{children:e.jsx(A,{children:"Setujui Komentar"})}),e.jsx("p",{children:"Apakah anda yakin ingin menyetujui komentar ini?"}),e.jsxs(E,{children:[e.jsx(m,{variant:"outline",onClick:()=>v(!1),children:"Batal"}),e.jsx(m,{onClick:()=>{o&&me(o.id)},children:"Setuju"})]})]})}),e.jsx(T,{open:ie,onOpenChange:N,children:e.jsxs(D,{children:[e.jsx(P,{children:e.jsx(A,{children:"Tolak Komentar"})}),e.jsx("p",{children:"Apakah anda yakin ingin menolak komentar ini?"}),e.jsxs(E,{children:[e.jsx(m,{variant:"outline",onClick:()=>N(!1),children:"Batal"}),e.jsx(m,{variant:"destructive",onClick:()=>{o&&he(o.id)},children:"Tolak"})]})]})}),e.jsx(T,{open:ne,onOpenChange:F,children:e.jsxs(D,{children:[e.jsx(P,{children:e.jsx(A,{children:"Hapus Komentar"})}),e.jsx("p",{children:"Apakah anda yakin ingin menghapus komentar ini?"}),e.jsxs(E,{children:[e.jsx(m,{variant:"outline",onClick:Q,children:"Batal"}),e.jsx(m,{variant:"destructive",onClick:()=>{o&&(pe(o.id),Q())},children:"Hapus"})]})]})})]})}export{We as default};
